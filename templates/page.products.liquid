{%- assign limit = 16 -%}
<div id="shopify-section-collection-template" class="shopify-section">
  <div data-section-id="collection-template" data-section-type="collection-template">
    <header class="section-header text-center">
      <div class="collection-hero">
        {% section 'image-bar' %}
      </div>
      <div class="shop-tabs" data-section-id="shop-tabs" data-section-type="shop-tabs">
        <div class="contentWrapper">
          <div class="tabsWrapper">
            <ul class="tabs social-sharing page-width">
              {% for link in linklists[page.handle].links %}
              {%- assign linkTitle = link.title | handleize -%}
              <li class="btn mobile-nav__toggle-button {% if forloop.first == true %}active{% endif %}"
                data-id="{{ linkTitle }}">{{ link.title }}</li>
              {% endfor %}
            </ul>
          </div>
          <span class="next-tab"><svg width="28" height="28" viewBox="0 0 28 28" fill="none"
              xmlns="http://www.w3.org/2000/svg">
              <circle cx="14" cy="14" r="12.75" transform="rotate(-90 14 14)" stroke="#5bb6ae" stroke-width="2.5">
              </circle>
              <path
                d="M20.0551 14.3273C20.2178 14.1394 20.2178 13.8606 20.0551 13.6727L16.378 9.4267C16.0749 9.07674 15.5 9.29108 15.5 9.75402L15.5 18.246C15.5 18.7089 16.0749 18.9233 16.378 18.5733L20.0551 14.3273Z"
                fill="#5bb6ae" stroke="#5bb6ae"></path>
              <path fill-rule="evenodd" clip-rule="evenodd" d="M15 16H7V12H15V16Z" fill="#5bb6ae"></path>
            </svg>
          </span>
        </div>
      </div>
      <script type="text/javascript">
        // hide all contents accept from the first div
        // $('.tabContent div:not(:first)').toggle();

        // hide the previous button
        // $('.previous-tab').hide();

        $('.tabs li').click(function () {
          if ($(this).is(':last-child')) {
            $('.next-tab').hide();
            $('.fade-out').hide();
          } else {
            $('.next-tab').show();
            $('.fade-out').show();
          }
          // if ($(this).is(':first-child')) {
          //     $('.previous-tab').hide();
          // } else {
          //     $('.previous-tab').show();
          // }
          var position = $(this).position();
          var corresponding = $(this).data("id");
          // scroll to clicked tab with a little gap left to show previous tabs
          scroll = $('.tabs').scrollLeft();
          $('.tabs').animate({
            'scrollLeft': scroll + position.left - 30
          }, 200);
          // hide all content divs
          $('.tabContent div').hide();
          // show content of corresponding tab
          $('div.' + corresponding).toggle();
          // remove active class from currently not active tabs
          $('.tabs li').removeClass('active');
          // add active class to clicked tab
          $(this).addClass('active');
        });

        // $('div a').click(function(e){
        //     e.preventDefault();
        //     $('li.active').next('li').trigger('click');
        // });
        $('.next-tab').click(function (e) {
          e.preventDefault();
          $('li.active').next('li').trigger('click');
        });
        // $('.previous-tab').click(function(e){
        //     e.preventDefault();
        //     $('li.active').prev('li').trigger('click');
        // });

        document.querySelectorAll('[data-id]').forEach(tab => {
          tab.addEventListener('click', function () {
            setTimeout(() => {
              document.querySelector(`#section-block-${this.dataset.id}`).scrollIntoView({
                behavior: 'smooth'
              });
            }, 300);

          })
        })
      </script>
    </header>
    {%- comment -%}How to add a collection to a page in Shopify
    https://avada.io/shopify/docs/add-collections-to-a-page.html{%- endcomment -%}
    {%- assign max_height = 345 -%}
    {% if linklists[page.handle].links.size > 0 %}
    <div class="page-width" id="Collection">
      <ul class="grid grid--uniform grid--view-items">
        {% for link in linklists[page.handle].links %}
        {%- assign linkTitle = link.title | handleize -%}
        <li id="section-block-{{ linkTitle }}" class="grid__item tab-products__product-block container">
          <h3>{{ link.title }}</h3>
          {% if link.links != blank %}
          <ul class="child grid grid-uniform grid--view-items">
            {% for child_link in link.links %}
            {% assign product = child_link.object %}
            <li class="grid__item small--one-half medium-up--one-third">
              {% include 'product-card-grid', max_height: max_height %}
            </li>
            {% endfor %}
          </ul>
          {% endif %}
        </li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
  </div>
</div>
